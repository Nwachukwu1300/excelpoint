{% extends "base.html" %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block extra_head %}
<style>
    :root {
        --primary-color: #0d6efd;
        --secondary-color: #6c757d;
        --light-bg: #ffffff;
        --card-bg: #ffffff;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --border-color: #e9ecef;
        
        /* Icon colors */
        --icon-tensorflow: #ff6f00;
        --icon-deeplearning: #0d6efd;
        --icon-pytorch: #ee4c2c;
        --icon-neural: #8e44ad;
        --icon-vision: #2ecc71;
        --icon-trophy: #ffc107;
        --icon-star: #f39c12;
        --icon-certification: #3498db;
        --icon-activity: #e74c3c;
    }
    
    body {
        background-color: var(--light-bg);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    .navbar {
        background-color: var(--primary-color);
        padding: 1rem 0;
    }
    
    .navbar-brand {
        color: #fff;
        font-weight: 600;
    }
    
    .navbar-nav .nav-link {
        color: rgba(255,255,255,.85);
    }
    
    .profile-header {
        padding: 2rem 0;
        background: #fff;
        border-bottom: 1px solid var(--border-color);
    }
    
    .profile-name {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .profile-email {
        font-size: 1.25rem;
        color: var(--text-secondary);
        margin-bottom: 2rem;
    }
    
    .stats-row {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 2rem;
    }
    
    .stat-item {
        flex: 1;
        margin-right: 2rem;
        min-width: 120px;
    }
    
    .stat-item:last-child {
        margin-right: 0;
    }
    
    .stat-value {
        font-size: 2.25rem;
        font-weight: 700;
        line-height: 1;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        font-size: 1rem;
        color: var(--text-secondary);
    }
    
    .section {
        background-color: #fafafa;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .section-title {
        display: flex;
        align-items: center;
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.75rem;
    }
    
    .section-title i {
        margin-right: 0.75rem;
    }
    
    /* Fix for the layout issue */
    .container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .profile-row {
        display: table;
        width: 100%;
        table-layout: fixed;
    }
    
    .profile-col {
        display: table-cell;
        width: 48%;
        vertical-align: top;
    }
    
    .profile-col:first-child {
        padding-right: 2%;
    }
    
    .profile-col:last-child {
        padding-left: 2%;
    }
    
    .skill-list {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .skill-item {
        background-color: #f8f9fa;
        padding: 0.5rem 1rem;
        border-radius: 30px;
        display: flex;
        align-items: center;
        border: 1px solid var(--border-color);
    }
    
    .skill-icon {
        margin-right: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-color);
    }
    
    .certification-item {
        margin-bottom: 1.25rem;
    }
    
    .certification-name {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .certification-issuer {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    .achievement-item {
        margin-bottom: 1.5rem;
        display: flex;
        align-items: flex-start;
    }
    
    .achievement-icon {
        width: 2rem;
        margin-right: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .achievement-icon i {
        font-size: 1.5rem;
        color: var(--icon-trophy);
    }
    
    .achievement-content {
        flex: 1;
    }
    
    .achievement-date {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .achievement-title {
        font-weight: 500;
        color: var(--primary-color);
    }
    
    .student-award {
        display: flex;
        align-items: center;
        margin-top: 1rem;
    }
    
    .award-icon {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        background-color: var(--icon-star);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
    }
    
    .award-icon i {
        color: white;
        font-size: 1.25rem;
    }
    
    .learning-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-top: 1rem;
    }
    
    .learning-stat {
        min-width: 150px;
    }
    
    .learning-stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .learning-stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    .activity-item {
        display: flex;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .activity-icon {
        width: 2rem;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        margin-right: 1rem;
    }
    
    .activity-icon i {
        color: var(--icon-activity);
    }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-title {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    
    .activity-time {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    @media (max-width: 992px) {
        .profile-row {
            display: block;
        }
        
        .profile-col {
            display: block;
            width: 100%;
            padding: 0 !important;
            margin-bottom: 2rem;
        }
        
        .stats-row {
            flex-direction: column;
        }
        
        .stat-item {
            margin-right: 0;
            margin-bottom: 1.5rem;
        }
    }
    
    /* Two-column grid layout for main content */
    .profile-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 4%;
        width: 100%;
    }
    
    @media (max-width: 992px) {
        .profile-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Better spacing & hierarchy for stats */
    .stats-row {
        gap: 2rem;
    }
    
    .stat-value {
        font-size: 2.5rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Profile Header -->
<div class="container py-4">
    <!-- User Info Card -->
    <div class="card mb-4 shadow-sm border-0">
        <div class="card-body p-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-6 fw-bold mb-1">{{ user.get_full_name|default:user.username|upper }}</h1>
                    <p class="text-muted">{{ user.email }}</p>
                    <div class="d-flex flex-wrap gap-3 mt-3">
                        <a href="{% url 'users:edit_profile' %}" class="btn btn-sm btn-primary">
                            <i class="fas fa-edit me-1"></i> Edit Profile
                        </a>
                        <a href="{% url 'users:user_skills' %}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-code me-1"></i> Manage Skills
                        </a>
                        <a href="{% url 'users:manage_achievements' %}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-trophy me-1"></i> Manage Achievements
                        </a>
                        <a href="{% url 'users:manage_certifications' %}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-certificate me-1"></i> Manage Certifications
                        </a>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row row-cols-2 text-center g-3">
                        <div class="col">
                            <div class="bg-light rounded-3 p-3">
                                <h2 class="h1 fw-bold text-primary mb-0">{{ enrolled_courses|default:"0" }}</h2>
                                <small class="text-muted">Enrolled</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="bg-light rounded-3 p-3">
                                <h2 class="h1 fw-bold text-primary mb-0">{{ profile_completion|default:"0" }}%</h2>
                                <small class="text-muted">Profile</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="bg-light rounded-3 p-3">
                                <h2 class="h1 fw-bold text-primary mb-0">{{ total_hours|default:"0" }}</h2>
                                <small class="text-muted">Hours</small>
                            </div>
                        </div>
                        <div class="col">
                            <div class="bg-light rounded-3 p-3">
                                <h2 class="h1 fw-bold text-primary mb-0">{{ current_streak|default:"0" }}</h2>
                                <small class="text-muted">Streak</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="row g-4">
        <!-- Left Column -->
        <div class="col-lg-6">
            <!-- Skills Section -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white p-3 border-0">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-code text-primary me-2 fs-4"></i>
                        <h2 class="h5 mb-0 fw-bold">Skills</h2>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="d-flex flex-wrap gap-2 mb-3">
                        {% if user_skills or user.skills.all or user.user_skills_direct.all %}
                            {% for skill in user_skills %}
                                <span class="badge rounded-pill bg-light text-dark border px-3 py-2">
                                    {% if 'tensorflow' in skill.skill_name|lower %}
                                        <i class="fab fa-tensorflow text-warning me-1"></i>
                                    {% elif 'deep learning' in skill.skill_name|lower %}
                                        <i class="fas fa-brain text-primary me-1"></i>
                                    {% elif 'pytorch' in skill.skill_name|lower %}
                                        <i class="fas fa-fire text-danger me-1"></i>
                                    {% elif 'neural' in skill.skill_name|lower %}
                                        <i class="fas fa-project-diagram text-purple me-1"></i>
                                    {% elif 'vision' in skill.skill_name|lower %}
                                        <i class="fas fa-eye text-success me-1"></i>
                                    {% elif 'python' in skill.skill_name|lower %}
                                        <i class="fab fa-python text-primary me-1"></i>
                                    {% elif 'data' in skill.skill_name|lower %}
                                        <i class="fas fa-database text-warning me-1"></i>
                                    {% else %}
                                        <i class="fas fa-code text-info me-1"></i>
                                    {% endif %}
                                    {{ skill.skill_name }}
                                </span>
                            {% endfor %}
                            
                            {% for skill in user.skills.all %}
                                <span class="badge rounded-pill bg-light text-dark border px-3 py-2">
                                    <i class="fas fa-code text-info me-1"></i>
                                    {{ skill.name }}
                                </span>
                            {% endfor %}
                            
                            {% for skill in user.user_skills_direct.all %}
                                <span class="badge rounded-pill bg-light text-dark border px-3 py-2">
                                    <i class="fas fa-code text-info me-1"></i>
                                    {{ skill.name }}
                                </span>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted">No skills added yet. Add skills to track your progress.</p>
                            <div class="mt-2">
                                <a href="{% url 'users:add_custom_skill' %}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus me-1"></i> Add Skills
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Achievements Section -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white p-3 border-0">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-trophy text-warning me-2 fs-4"></i>
                        <h2 class="h5 mb-0 fw-bold">Achievements & Awards</h2>
                    </div>
                </div>
                <div class="card-body p-3">
                    {% if user.user_achievements.all %}
                        {% for achievement in user.user_achievements.all|slice:":3" %}
                            <div class="d-flex align-items-start mb-3 pb-3 {% if not forloop.last %}border-bottom{% endif %}">
                                <div class="me-3">
                                    <div class="rounded-circle bg-light p-2 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                                        <i class="fas {% if achievement.type == 'award' %}fa-award text-warning{% elif achievement.type == 'scholarship' %}fa-graduation-cap text-primary{% else %}fa-medal text-danger{% endif %} fs-5"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-muted small">{{ achievement.date_received|date:"F Y"|default:"Fall 2023" }}</div>
                                    <div class="fw-semibold">{{ achievement.title }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-3">
                            <p class="text-muted">No achievements added yet.</p>
                            <a href="{% url 'users:manage_achievements' %}" class="btn btn-sm btn-primary mt-2">
                                <i class="fas fa-plus me-1"></i> Add Achievements
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Right Column -->
        <div class="col-lg-6">
            <!-- Certifications Section -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white p-3 border-0">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-certificate text-info me-2 fs-4"></i>
                        <h2 class="h5 mb-0 fw-bold">Certifications</h2>
                    </div>
                </div>
                <div class="card-body p-3">
                    {% if user.certifications.all %}
                        {% for cert in user.certifications.all %}
                            <div class="mb-3 {% if not forloop.last %}pb-3 border-bottom{% endif %}">
                                <div class="fw-semibold">{{ cert.name }}</div>
                                <div class="text-muted small">{{ cert.issuer }}</div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-3">
                            <p class="text-muted">No certifications added yet.</p>
                            <a href="{% url 'users:manage_certifications' %}" class="btn btn-sm btn-primary mt-2">
                                <i class="fas fa-plus me-1"></i> Add Certifications
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white p-3 border-0">
                    <div class="d-flex align-items-center">
                        <i class="far fa-clock text-danger me-2 fs-4"></i>
                        <h2 class="h5 mb-0 fw-bold">Recent Activity</h2>
                    </div>
                </div>
                <div class="card-body p-3">
                    {% if recent_activity %}
                        {% for activity in recent_activity|slice:":3" %}
                            <div class="d-flex align-items-center mb-3 {% if not forloop.last %}pb-3 border-bottom{% endif %}">
                                <div class="me-3">
                                    <div class="rounded-circle bg-light p-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="fas {% if 'course' in activity.description|lower %}fa-book text-primary{% elif 'skill' in activity.description|lower %}fa-code text-success{% else %}fa-trophy text-warning{% endif %} fs-5"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="fw-semibold">{{ activity.title }}</div>
                                    <div class="small text-muted">{{ activity.timestamp|timesince }} ago</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <div class="mb-3">
                                <i class="far fa-clock text-muted fa-3x"></i>
                            </div>
                            <p class="text-muted">No recent activity found.</p>
                            <a href="{% url 'learning:dashboard' %}" class="btn btn-sm btn-primary mt-2">Start Learning</a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Learning Achievements -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white p-3 border-0">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-star text-warning me-2 fs-4"></i>
                        <h2 class="h5 mb-0 fw-bold">Learning Achievements</h2>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="row row-cols-2 g-3">
                        <div class="col">
                            <div class="p-3 bg-light rounded-3">
                                <div class="fw-bold h4 mb-0 text-primary">{{ skills_count|default:"0" }}</div>
                                <div class="small text-muted">Maps of Skills</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-light rounded-3">
                                <div class="fw-bold h4 mb-0 text-primary">{{ completed_courses|default:"0" }}</div>
                                <div class="small text-muted">Courses Completed</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-light rounded-3">
                                <div class="fw-bold h4 mb-0 text-primary">{{ previous_awards|default:"0" }}</div>
                                <div class="small text-muted">Previous Awards</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-3 bg-light rounded-3">
                                <div class="fw-bold h4 mb-0 text-primary">{{ community_contributions|default:"0" }}</div>
                                <div class="small text-muted">Community Contributions</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 